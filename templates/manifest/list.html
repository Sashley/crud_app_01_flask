{% extends "generic/list_base.html" %}

{% block title %}Manifests{% endblock %}

{% block entity_name %}Manifest{% endblock %}

{% block before_table %}
<div class="mb-4 flex justify-end">
    <button type="button"
            class="inline-flex items-center px-4 py-2 text-sm text-gray-700 rounded-md bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:ring-offset-2"
            hx-get="{{ url_for('manifest.load_form') }}"
            hx-target="#modal-container">
        New Manifest
    </button>
</div>
{% endblock %}

{% block table_content %}
    <div id="manifest-table"
         class="overflow-hidden"
         hx-trigger="manifestSaved from:body"
         hx-get="{{ url_for('manifest.list_manifest') }}"
         hx-target="#manifest-table">
        {% include 'manifest/table.html' %}
    </div>
{% endblock %}

{% block after_table %}
    <!-- Modal Container -->
    <div id="modal-container"></div>

    <!-- Line Items Section -->
    <div id="lineitem-container" class="mt-4">
        <!-- Line items will be loaded here when a manifest is clicked -->
    </div>

    <script>
        // Listen for successful form submission
        document.body.addEventListener('htmx:afterSwap', function(evt) {
            if (evt.detail.target.id === 'modal-container' && !evt.detail.xhr.response) {
                // Trigger table refresh
                htmx.trigger('body', 'manifestSaved');
            }
        });

        // Prevent row click when clicking action buttons
        document.addEventListener('click', function(evt) {
            if (evt.target.matches('button')) {
                evt.stopPropagation();
            }
        });
    </script>

    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .overflow-hidden::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .overflow-hidden {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
{% endblock %}
